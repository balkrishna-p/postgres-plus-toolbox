#!/usr/bin/env python3
import os
import psycopg2


def main():
    conn = psycopg2.connect(
        host=os.getenv("PGHOST", "localhost"),
        port=os.getenv("PGPORT", "5432"),
        user=os.getenv("PGUSER", "postgres"),
        password=os.getenv("PGPASSWORD", ""),
        dbname=os.getenv("PGDATABASE", "postgres"),
    )
    cur = conn.cursor()
    cur.execute(
        """
        SELECT
            now()                               AS current_time,
            pg_last_xact_replay_timestamp()     AS replay_time,
            EXTRACT(EPOCH FROM (
                now() - pg_last_xact_replay_timestamp()
            ))                                  AS replay_delay_seconds
        """
    )
    row = cur.fetchone()
    print(f"Current time:            {row[0]}")
    print(f"Replay time:             {row[1]}")
    print(f"Replay delay (seconds):  {row[2]}")
    cur.close()
    conn.close()


if __name__ == "__main__":
    main()
